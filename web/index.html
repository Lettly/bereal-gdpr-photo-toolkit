<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>BeReal GDPR Photo Toolkit - Web App</title>
        <link rel="stylesheet" href="styles.css" />
        <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    </head>
    <body>
        <div class="container">
            <header>
                <h1>ü§≥ BeReal GDPR Photo Toolkit</h1>
                <p>
                    Process your BeReal photos and videos directly in your
                    browser
                </p>
            </header>

            <div class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <div class="upload-icon">üìÅ</div>
                        <h3>Upload Your BeReal Data</h3>
                        <p>
                            Drop your BeReal export ZIP file here or click to
                            browse
                        </p>
                        <input
                            type="file"
                            id="fileInput"
                            accept=".zip"
                            multiple
                        />
                        <button
                            class="browse-btn"
                            onclick="document.getElementById('fileInput').click()"
                        >
                            Browse Files
                        </button>
                    </div>
                </div>
            </div>

            <div
                class="upload-progress-section"
                id="uploadProgressSection"
                style="display: none"
            >
                <h2>Upload Progress</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="uploadProgressFill"></div>
                </div>
                <div class="progress-text" id="uploadProgressText">
                    Reading files...
                </div>
            </div>

            <div
                class="decompression-progress-section"
                id="decompressionProgressSection"
                style="display: none"
            >
                <h2>ZIP Decompression Progress</h2>
                <div class="progress-bar">
                    <div
                        class="progress-fill"
                        id="decompressionProgressFill"
                    ></div>
                </div>
                <div class="progress-text" id="decompressionProgressText">
                    Extracting files...
                </div>
                <div class="progress-details" id="decompressionProgressDetails">
                    <small>Preparing to extract...</small>
                </div>
            </div>

            <div
                class="settings-section"
                id="settingsSection"
                style="display: none"
            >
                <h2>Processing Settings</h2>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="convertToJpeg" checked />
                            Convert WebP images to JPEG
                        </label>
                        <small
                            >Enables metadata injection and better
                            compatibility</small
                        >
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="keepOriginalFilename" />
                            Keep original filename in output
                        </label>
                        <small
                            >Include original filename in the processed file
                            name</small
                        >
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="createCombinedImages" />
                            Create combined images
                        </label>
                        <small
                            >Combine primary and secondary images like original
                            BeReal memories</small
                        >
                    </div>
                </div>
                <div
                    class="video-info-box"
                    style="
                        background-color: #f0f8ff;
                        border: 1px solid #b6d7ff;
                        padding: 12px;
                        border-radius: 8px;
                        margin: 15px 0;
                    "
                >
                    <h4 style="margin: 0 0 8px 0; color: #0066cc">
                        üé• Video Processing
                    </h4>
                    <p style="margin: 0; font-size: 0.9em; color: #333">
                        MP4 videos and BTS media are now supported! Videos will
                        be renamed with timestamps and preserved with their
                        original quality.
                        <strong>Note:</strong> Audio synchronization between
                        primary/secondary videos requires the desktop Python
                        version with FFmpeg.
                    </p>
                </div>
                <button
                    class="process-btn"
                    id="processBtn"
                    onclick="startProcessing()"
                >
                    Start Processing
                </button>
            </div>

            <div
                class="progress-section"
                id="progressSection"
                style="display: none"
            >
                <h2>Processing Progress</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">
                    Initializing...
                </div>
                <div
                    class="memory-indicator"
                    id="memoryIndicator"
                    style="display: none"
                >
                    <small
                        >Memory: <span id="memoryUsage">0MB</span> /
                        <span id="memoryLimit">0MB</span></small
                    >
                </div>
                <div class="debug-controls" style="margin-bottom: 15px">
                    <button class="debug-btn" onclick="toggleDebugMode()">
                        üîß Debug Mode
                    </button>
                    <button class="debug-btn" onclick="clearLogs()">
                        üóëÔ∏è Clear Logs
                    </button>
                    <button class="debug-btn" onclick="showSystemInfo()">
                        ‚ÑπÔ∏è System Info
                    </button>
                    <button class="debug-btn" onclick="forceGC()">
                        üßπ Force Cleanup
                    </button>
                </div>
                <div class="log-output" id="logOutput"></div>
            </div>

            <div
                class="results-section"
                id="resultsSection"
                style="display: none"
            >
                <h2>Processing Complete</h2>
                <div class="results-summary" id="resultsSummary"></div>
                <div class="download-section">
                    <button
                        class="download-btn"
                        id="downloadBtn"
                        onclick="downloadResults()"
                    >
                        üì• Download Processed Files
                    </button>
                </div>
            </div>

            <div class="info-section">
                <h2>About This Tool</h2>
                <p>
                    This web application processes BeReal GDPR export data
                    directly in your browser using WebAssembly. Your files never
                    leave your device, ensuring complete privacy.
                </p>

                <div class="features">
                    <div class="feature">
                        <h3>üñºÔ∏è Image Processing</h3>
                        <p>
                            Converts WebP to JPEG, adds EXIF/IPTC metadata
                            including timestamps, GPS coordinates, and captions
                        </p>
                    </div>
                    <div class="feature">
                        <h3>üé• Video Processing</h3>
                        <p>
                            Processes MP4 videos including BTS media. Videos are
                            renamed with timestamps and basic metadata is
                            preserved. For audio synchronization between
                            primary/secondary videos, use the desktop Python
                            version.
                        </p>
                    </div>
                    <div class="feature">
                        <h3>üîí Privacy First</h3>
                        <p>
                            All processing happens locally in your browser - no
                            data is sent to any server
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <script src="app.js"></script>
    </body>
</html>
